!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.SpacedRepetition={})}(this,function(t){var e=function(t){void 0===t&&(t={}),this.options={debug:t.debug,nowFn:t.nowFn},this.getDueCards=this.getDueCards.bind(this)};e.prototype.getDay=function(t){void 0===t&&(t={forDate:Date.now()});var e=t.forDate;try{"function"==typeof this.options.nowFn&&(e=this.options.nowFn())}catch(t){this.options.debug&&console.error(t)}return Math.floor(e/864e5)},e.prototype.computeNextRepetition=function(t){if(0===t.length)return this.getDay()-1;var e=t[t.length-1],n=this.getDay({forDate:e.timestamp});if(e.difficulty>=3){if(1===t.length)return n+1;if(2===t.length)return n+6;var i=2.5;return t.forEach(function(t){i+=+(.1-(4-t.difficulty)*(.08+.02*(4-t.difficulty)))}),i<1.3&&(i=1.3),n+Math.ceil(t.length*i)}return n},e.prototype.getDueCards=function(t,e){var n=this,i=this.getDay();return t.map(function(t){var i=e.filter(function(e){return e.card===t.id});return[t,n.computeNextRepetition(i)]}).filter(function(t){return t[1]<=i})};var n=(new e).getDueCards;t.DAY_IN_MILLISECONDS=864e5,t.default=e,t.SpacedRepetition=e,t.getDueCards=n});
